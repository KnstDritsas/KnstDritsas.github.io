/* ================= THEME TOKENS (better contrast) ================= */
:root{
  --bg:#0b0f15;
  --bg-soft:#0f1422;
  --card:#0f172a;

  --text:#e9edf4;
  --heading:#f7faff;
  --muted:#9fb0c4;
  --link:#7dd3fc;

  --border: rgba(148,163,184,.2);
  --ring: 0 0 0 .25rem rgba(56,189,248,.38);

  --accent:#ffc857;
  --accent-2:#38bdf8;
  --accent-2-weak: color-mix(in oklab, var(--accent-2) 18%, transparent);
  --accent-2-weak-2: color-mix(in oklab, var(--accent-2) 10%, transparent);

  --success:#22c55e;
  --warning:#f59e0b;
  --danger:#ef4444;
  --locked:#64748b;

  --elev-1: 0 4px 16px rgba(2,6,23,.25);
  --elev-2: 0 10px 30px rgba(2,6,23,.4);

  --font-size: clamp(15px, .88vw + 12px, 17px);
  --radius: 1rem;
  --radius-sm: .8rem;

  --content-gap: clamp(12px, 2vw, 24px);
  --content-px: clamp(12px, 3vw, 28px);

  /* NEW: topbar height token for scroll margins */
  --topbar-h: 56px;
}

html[data-theme="light"]{
  --bg:#f7fafc;
  --bg-soft:#eef2f7;
  --card:#ffffff;
  --text:#0c1220;
  --heading:#0a0f1b;
  --muted:#5c6b80;
  --link:#0a66c2;

  --border: rgba(15,23,42,.14);
  --accent-2-weak: color-mix(in oklab, var(--accent-2) 12%, transparent);
  --accent-2-weak-2: color-mix(in oklab, var(--accent-2) 8%, transparent);
}

html[data-theme="light"] .sidebar{ background:linear-gradient(180deg, #eef2f7 0%, var(--bg) 100%) }
html[data-theme="light"] .topbar{ background:color-mix(in oklab, #e8eef6 75%, transparent) }
html[data-theme="light"] .card{ background:#fff }
html[data-theme="light"] .kanban .column{ background:rgba(255,255,255,.85) }

/* Native UI palettes */
html[data-theme="dark"]{ color-scheme: dark }
html[data-theme="light"]{ color-scheme: light }

/* Bootstrap palette mapping */
html{
  --bs-body-bg: var(--bg);
  --bs-body-color: var(--text);
  --bs-border-color: var(--border);
  --bs-secondary-color: var(--muted);
  --bs-card-bg: var(--card);
  --bs-link-color: var(--link);
}

/* ================= RESET & BASE ================= */
html,body{height:100%; background:var(--bg); color:var(--text)}
html{font-size: var(--font-size)}
*{box-sizing:border-box; min-width:0}
img{max-width:100%; height:auto; display:block}

/* NEW: universal safe wrapping to prevent layout blowups */
:where(p,li,small,span,h1,h2,h3,h4,h5,h6){word-wrap:break-word; overflow-wrap:anywhere}

h1,h2,h3,h4,h5,h6{color:var(--heading); line-height:1.2; margin-top:.15em}
p,li,small{color:var(--text)}
a{color:var(--link); text-decoration:none}
a:hover{text-decoration:underline}
::selection{background: color-mix(in oklab, var(--accent-2) 35%, transparent); color: var(--heading)}

a,button,input,select,textarea{
  transition: box-shadow .18s ease, background-color .18s ease, color .18s ease, border-color .18s ease, transform .18s ease
}
:focus{outline:none}
:focus-visible{box-shadow: var(--ring); border-color: var(--accent-2)}

/* NEW: make in-page anchors account for sticky topbar */
[id]{ scroll-margin-top: calc(var(--topbar-h) + 12px) }

/* Animated backdrop */
body::before{
  content:""; position:fixed; inset:calc(-1 * max(20vmax, 20vh)); z-index:-1;
  background:
    radial-gradient(60vmax 60vmax at 10% 10%, var(--accent-2-weak), transparent 60%),
    radial-gradient(60vmax 60vmax at 90% 20%, color-mix(in oklab, var(--accent) 18%, transparent), transparent 60%),
    radial-gradient(70vmax 70vmax at 80% 90%, color-mix(in oklab, var(--success) 14%, transparent), transparent 60%);
  filter: blur(40px);
  animation: floatBg 18s ease-in-out infinite alternate;
}
@keyframes floatBg{to{transform: translateY(-2vmax) translateX(1vmax) scale(1.02)}}

/* Layout */
.app{
  display:grid;
  grid-template-columns: minmax(220px, 280px) 1fr; /* flexible sidebar */
  min-height: 100dvh;
  container-type: inline-size; /* enables container queries below */
}
.content{ display:flex; flex-direction:column; min-width:0 }
.main{ padding: var(--content-px); gap: var(--content-gap) }

/* ================= SIDEBAR ================= */
.logo-link {
  width: 48px;
  height: 48px;
  overflow: hidden;
  background: var(--accent-2-weak);
  flex-shrink: 0;
  border-radius: 50%;
}
.logo-img {
  object-fit: cover;
  width: 100%;
  height: 100%;
}

/* NEW: allow brand text to wrap up to 2 lines gracefully */
.brand-text{min-width:0; flex:1}
.brand-text h1{
  white-space: normal;
  line-height: 1.25;
  margin:0;
  display:-webkit-box;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.brand-text p{font-size:.8rem; margin:0}

.sidebar{
  background:linear-gradient(180deg, #0d1324 0%, var(--bg) 100%);
  border-right:1px solid var(--border);
  position:sticky; top:0; height:100dvh;
}
.brand{display:flex; align-items:center; gap:.75rem; padding:1.1rem 1.25rem .6rem}
.brand .logo{
  inline-size:48px; block-size:48px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, var(--accent-2) 0%, color-mix(in oklab, var(--accent-2) 65%, #0ea5e9) 45%, var(--bg) 70%);
  box-shadow:0 0 0 3px var(--accent-2-weak), inset 0 1px 6px rgba(255,255,255,.18);
}
.brand h1{font-size:clamp(1rem, .6vw + .9rem, 1.15rem); color:var(--heading)}

.links{padding:.75rem 1rem 1rem}
.nav-link{
  color:var(--muted); border-radius:.8rem; padding:.6rem .75rem; font-weight:600;
  display:flex; align-items:center; gap:.5rem;
}
.nav-link:hover,.nav-link.active{
  color:var(--heading);
  background:var(--accent-2-weak);
  box-shadow:0 6px 20px var(--accent-2-weak);
  text-decoration:none;
}

.social{padding:.5rem 1.25rem 1.25rem}
.social .btn{border-color:var(--border)}
.btn-outline-light{color:var(--heading); border-color:var(--border)}
.btn-outline-light:hover{background:color-mix(in oklab, var(--heading) 6%, transparent)}

/* ================= TOPBAR ================= */
.topbar{
  position:sticky; top:0; z-index:10;
  backdrop-filter:saturate(140%) blur(6px);
  background:color-mix(in oklab, #0d1324 55%, transparent);
  border-bottom:1px solid var(--border);
  padding-inline: var(--content-px);
  min-height: var(--topbar-h); /* NEW: consistent height */
  display:flex; align-items:center;
}
.topbar .input-group{ width: clamp(180px, 38vw, 340px) }
.topbar .input-group .form-control{color:var(--text)}
.topbar .input-group .form-control::placeholder{color:var(--muted)}
.topbar .input-group:focus-within{box-shadow: var(--ring)}
html[data-theme="light"] .topbar{ background:color-mix(in oklab, #e8eef6 75%, transparent) }

/* ================= CARDS & ELEMENTS ================= */
.card{
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow: var(--elev-1);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  color:var(--text);
  padding: clamp(.8rem, 1.2vw, 1rem);
}
@media (hover:hover){
  .card:hover{transform: translateY(-1px); box-shadow: var(--elev-2)}
}
html[data-theme="light"] .card{background:#fff}
.card-ghost{background:transparent; border-style:dashed}

.metric{display:flex; align-items:center; gap:.75rem}
.metric i{font-size:1.25rem; color:var(--heading)}
.metric .value{font-weight:800; font-size:clamp(1.1rem, .8vw + 1rem, 1.35rem); color:var(--heading)}

.badge{border:1px solid transparent}
.badge.text-bg-success{
  background: color-mix(in oklab, var(--success) 18%, transparent);
  color: color-mix(in oklab, var(--success) 88%, black);
  border-color: color-mix(in oklab, var(--success) 35%, transparent);
}
.badge.text-bg-warning{
  background: color-mix(in oklab, var(--warning) 18%, transparent);
  color: color-mix(in oklab, var(--warning) 90%, black);
  border-color: color-mix(in oklab, var(--warning) 35%, transparent);
}
.badge.text-bg-secondary{
  background: color-mix(in oklab, var(--muted) 22%, transparent);
  color: var(--heading);
  border-color: color-mix(in oklab, var(--muted) 38%, transparent);
}

/* ================= KANBAN (fully fluid) ================= */
.kanban{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: var(--content-gap);
}
.kanban .column{
  background:rgba(255,255,255,.02);
  border:1px solid var(--border);
  border-radius:1rem;
  padding:.75rem;
}
html[data-theme="light"] .kanban .column{ background:rgba(255,255,255,.88) }

.kanban .col-title{
  display:flex; align-items:center; justify-content:space-between;
  margin:.25rem .25rem .75rem;
  gap:.5rem;
  flex-wrap:wrap;
}

.ticket{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:.9rem;
  padding:.9rem;
  margin-bottom:.75rem;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
@media (hover:hover){
  .ticket:hover{box-shadow: var(--elev-1); transform: translateY(-1px)}
}
.ticket .badge{font-size:.72rem}
.ticket.locked{opacity:.85; position:relative}
.ticket.locked::after{
  content:"\f30d  Locked"; font:900 12px/1 "Font Awesome 6 Sharp";
  position:absolute; top:.55rem; right:.55rem; padding:.25rem .5rem; border-radius:.5rem;
  background:color-mix(in oklab, var(--locked) 18%, transparent);
  border:1px solid color-mix(in oklab, var(--locked) 35%, transparent);
  color:#cbd5e1
}

/* ================= SKILLS ================= */
.skill-chip{
  display:inline-flex; align-items:center; gap:.4rem;
  padding:.35rem .6rem; border-radius:999px; border:1px solid var(--border);
  margin:.25rem; background:rgba(255,255,255,.03); color:var(--heading)
}
.bar{
  height:8px; border-radius:999px; background:linear-gradient(180deg,#0b1220,#0a0f1c);
  overflow:hidden; border:1px solid var(--border)
}
.bar > span{display:block; height:100%; box-shadow: inset 0 0 6px rgba(255,255,255,.25)}

/* ================= TIMELINE ================= */
.timeline{position:relative; padding-left:1.5rem}
.timeline::before{content:""; position:absolute; left:.5rem; top:.2rem; bottom:.2rem; width:2px; background:var(--border)}
.tl-item{position:relative; margin-bottom:1rem}
.tl-item::before{
  content:""; position:absolute; left:-.05rem; top:.45rem;
  width:.75rem; height:.75rem; border-radius:999px; background:var(--accent-2);
  box-shadow:0 0 0 3px color-mix(in oklab, var(--accent-2) 35%, transparent)
}

.status-pill{
  display:inline-flex; align-items:center; gap:.45rem;
  padding:.35rem .6rem; border-radius:999px; font-size:.76rem;
  border:1px solid var(--border); line-height:1; color:var(--heading)
}
.pill-success{
  background:color-mix(in oklab, var(--success) 12%, transparent);
  border-color:color-mix(in oklab, var(--success) 35%, transparent);
  color:color-mix(in oklab, var(--success) 88%, white);
}
.pill-progress{
  background:color-mix(in oklab, var(--warning) 12%, transparent);
  border-color:color-mix(in oklab, var(--warning) 35%, transparent);
  color:color-mix(in oklab, var(--warning) 90%, white);
}
.pill-locked{
  background:color-mix(in oklab, var(--locked) 16%, transparent);
  border-color:color-mix(in oklab, var(--locked) 35%, transparent);
  color:#cbd5e1
}

/* ================= UTILITIES ================= */
.text-secondary{color:var(--muted) !important}
.shadow-soft{box-shadow:var(--elev-1)}
.small{font-size:.9em}

/* NEW: smoother mobile scrolling & no overscroll chaining */
html{ -webkit-text-size-adjust: 100% }
body{ overscroll-behavior-y: none }

::-webkit-scrollbar{height:10px; width:10px}
::-webkit-scrollbar-track{background:rgba(148,163,184,.06)}
::-webkit-scrollbar-thumb{background:rgba(148,163,184,.28); border-radius:999px}
::-webkit-scrollbar-thumb:hover{background:rgba(148,163,184,.42)}
*{scrollbar-width: thin; scrollbar-color: rgba(148,163,184,.28) rgba(148,163,184,.06)}

/* ================= CONTAINER & MEDIA QUERIES ================= */

/* NEW: container queries let the sidebar adjust even when the page isnâ€™t narrow */
@container (max-width: 260px){
  .brand{padding: .9rem .9rem .5rem}
  .brand .logo, .logo-link{inline-size:40px; block-size:40px}
  .brand-text p{ font-size: .75rem }
}

/* Shrink to single column; sidebar becomes natural height */
@media (max-width: 992px){
  .app{grid-template-columns:1fr}
  .sidebar{position:relative; height:auto}
  .topbar{padding-inline: var(--content-px)}
  /* NEW: make kanban columns a bit narrower on tablets */
  .kanban{ grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) }
}

/* Small phones */
@media (max-width: 640px){
  .brand h1{font-size:1rem}
  .badge{font-size:.7rem}
  .status-pill{font-size:.72rem}
  .main{padding: clamp(10px, 3.5vw, 18px)}
  /* NEW: allow even smaller kanban cards on very narrow screens */
  .kanban{ grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)) }
  /* NEW: reduce internal paddings for denser layout */
  .card{ padding: clamp(.7rem, 2.5vw, .9rem) }
  .nav-link{ padding:.55rem .65rem }
}

/* Respect user prefs */
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{animation: none !important; transition: none !important}
}
@media (prefers-reduced-transparency: reduce){
  .topbar{backdrop-filter:none; background:color-mix(in oklab, var(--bg) 92%, transparent)}
  body::before{display:none}
}

/* iOS safe areas */
@supports (padding: max(0px)) {
  .topbar{ padding-top: max(var(--content-gap), env(safe-area-inset-top)) }
  .sidebar{ padding-bottom: max(.5rem, env(safe-area-inset-bottom)) }
}

/* ================= PRINT ================= */
@media print{
  @page{ size: A4; margin: 12mm }
  html{font-size: 12px}
  body{ background:white; color:black }
  .sidebar, .topbar, .btn, .input-group, .status-pill.pill-progress{ display:none !important }
  .app{ display:block }
  .card, .column, .ticket{ border-color:#ccc; box-shadow:none; background:white }
  a[href]::after{ content: " (" attr(href) ")"; font-size:10px; color:#555 }
}
